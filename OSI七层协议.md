# 四十、OSI七层协议
| `osi`模型  | 各层级说明                                         |
| ---------- | -------------------------------------------------- |
| 应用层     | 供操作系统或应用进行网络通信的标准接口             |
| 表示层     | 将不同的编码方式转换成网络通信中采用的标准表现形式 |
| 会话层     | 不同PC不同进程间建立或解除连接，插入同步点         |
| 传输层     | 两个主机间端对端的数据连接与传输                   |
| 网络层     | 选择路由并正确的找着目标主机                       |
| 数据链路层 | 两个相邻节点间准确的数据传输                       |
| 物理层     | 原始比特数据在物理介质上的传输                     |

| `tcp/ip`模型 | 层次说明                                                     | 网络协议                           |
| ------------ | ------------------------------------------------------------ | ---------------------------------- |
| 应用层       | 供操作系统或应用进行网络通信的标准接口<br>将不同的编码方式转换成网络通信中采用的标准表现形式<br>不同PC不同进程间建立或解除连接，插入同步点 | `Telnet`,`FTP`,`SMTP`,`DNS`,`HTTP` |
| 传输层       | 两个主机间端对端的数据连接与传输                             | `TCP`,`UDP`                        |
| 网络层       | 选择路由并正确的找着目标主机                                 | `IP`,`ARP`,`RARP`,`ICMP`           |
| 数据链路层   | 两个相邻节点间准确的数据传输<br>原始比特数据在物理介质上的传输 | `网络通信硬件及接口`               |

互联网协议按照功能不同分为osi七层或tcp/ip五层或tcp/ip四层
![OSI七层协议](https://images.gitee.com/uploads/images/2020/0831/191338_9f2418ea_7841459.png "1036857-20161008145544426-736439132.png")
每层运行常见物理设备
![](https://images.gitee.com/uploads/images/2020/0831/191444_74fb3207_7841459.png "1036857-20161008144925254-1398507493.png")

OSI七层协议数据传输的封包与解包过程 
![输入图片说明](https://images.gitee.com/uploads/images/2020/0831/191736_b7dc2b08_7841459.gif "1036857-20200415215541847-564448301.gif")
> 1. 数据到达传输层时会加入`tcp`或`udp`报头, 此时称为数据段(segment)
> 2. 数据段(segment)到达网络层时加入`IP`报头, 此时称为数据包(packet)
> 3. 数据包(packet)到达数据链路层时加入 *以太网帧头*, 此时称为帧(frame)
> 4. 帧(fram)到达物理层通过转码率转为位数据，此时称为位(bit) 

## 40.1 tcp/ip五层协议
### 40.1.1 物理层
物理层功能：主要是基于电器特性发送高低电压(电信号)，高电压对应数字1，低电压对应数字0

![输入图片说明](https://images.gitee.com/uploads/images/2020/0831/200145_5d281669_7841459.png "1036857-20161008154500754-704720294.png")

### 40.1.2 数据链路层
单纯的电信号0和1没有任何意义，必须规定电信号多少位一组，每组什么意思。**数据链路层就是定义了电信号的分组方式**

* **以太网协议(ethernet)**
> * 一组电信号构成一个数据，叫做‘帧’
> * 每一数据帧分成：报头`head`和数据`data`两部分<br>
> *data*: 来自网络层的整体数据(数据包)<br>
> **帧**: ![输入图片说明](https://images.gitee.com/uploads/images/2020/0901/102047_20f3f286_7841459.png "无标题.png")
> * `mac`地址: 每块网卡出厂时都被烧制上一个世界唯一的`mac`地址，长度为`48`位`2`进制，通常由`12`位`16`进制数表示（前六位是厂商编号，后六位是流水线号）。`head`中包含有源地址和目标地址`MAC`地址
> * **广播: **: 以太网协议的工作方式。![输入图片说明](https://images.gitee.com/uploads/images/2020/0901/103555_65fe6ef1_7841459.png "1036857-20161008171118317-164674895.png")
> 

### 40.1.3 网络层
有了`ethernet`、`mac`地址、广播的发送方式，计算机就可以彼此通信了。但是，如果所有计算都在一个广播域中，计算机通信将会是一种灾难；因为每一台计算都将会收到消息。

网络层的作用就是对广播域进行划分，使得每个广播域独立开。然后通过路由的方式链接广播域。
![输入图片说明](https://images.gitee.com/uploads/images/2020/0902/220113_824086c2_7841459.png "1036857-20161008172732957-102296982.png")
> 网络层功能: 引入一套新的地址用来区分不同的广播域／子网，这套地址即网络地址
> 网关: 不同广播域通信接口，通过 *路由协议* 进行通信
> 
> * **头**: 源地址和目标地址(`ip`地址)
> * **数据**: 来自传输层的整体数据(数据段)
> * 网络层的数据称为数据包

* `IP`协议
    > 规定网络地址的协议叫ip协议，它定义的地址称之为ip地址，广泛采用的v4版本即ipv4，它规> 定网络地址由32位2进制表示<br>
    > 范围`0.0.0.0---255.255.255.255`<br>
    > 一个ip地址通常写成四段十进制数，例：`172.16.10.1`

* `ip`地址分成两部分
    > 网络部分：标识子网<br>
    > 主机部分：标识主机<br>
    > 
    > 注意：单纯的`ip`地址段只是标识了`ip`地址的种类，从网络部分或主机部分都无法辨识一个`ip`所处的子网
    > 例：172.16.10.1与172.16.10.2并不能确定二者处于同一子网
* 子网掩码
    > 就是表示子网络特征的一个参数, 它在形式上等同于IP地址，也是一个32位二进制数字，它的
    > **网络部分全部为1，主机部分全部为0**。比如，IP地址172.16.10.1，如果已知网络部分是前24
    > 位，主机部分是后8位，那么子网络掩码就是`11111111.11111111.11111111.00000000`，写成
    > 十进制就是`255.255.255.0`。
    > * **子网判断**<br>
    > `ip`地址与子网掩码进行**按位与(`&`)**运算, 如果结果相同，则是同一子网。
    > 
    > * `IP`协议的作用: 
    >     1. 为每一台计算机分配IP地址
    >     2. 确定哪些地址在同一个子网络
* `ARP`协议
> 功能: 通过目标主机的`ip`地址获取目标主机的`mac`地址<br>
> 工作方式：每台主机ip都是已知的
> 1. 首先通过`ip`地址和子网掩码区分出自己所处的子网
> 2. 如果不是同一子网，通过`arp`获取的是网关的`mac`
> 3. 如果是同一子网，这个包会以广播的方式在发送端所处的子网内传输，所有主机接收后拆开包，发现目标`ip`为自己的，就响应，返回自己的`mac`

### 40.1.4 传输层
网络层的`ip`地址用于区分子网，数据链路层的`mac`地址确定主机。通信时建立在应用程序之间的，一台电脑上会运行多个不同的程序，为了确定接收数据的应用程序，为应用程序分配了不同的标识号，也即是端口(`port`)，**端口即应用程序与网卡关联的编号**。
* 传输层，建立了端口到端口之间的通信
    > 端口号: `0~65535`，其中`0~1023`由操作系统进行管理
* `tcp`协议
    > 可靠传输，`TCP`数据包没有长度限制，理论上可以无限长，但是为了保证网络的效率，通常`TCP`数据包的长度不会超过`IP`数据包的长度，以确保单个`TCP`数据包不必再分割。<br>
    >
    > **tcp报文:** <br>
    >![输入图片说明](https://images.gitee.com/uploads/images/2020/0916/212008_c9409ec4_7841459.png "tcp报文.png")
    > 
    > **tcp三次握手和四次挥手**<br>
    > ![输入图片说明](https://images.gitee.com/uploads/images/2020/0916/212201_5dd42c6d_7841459.png "tcp34.png")    

* `udp`协议
    > 不可靠传输，”报头”部分一共只有8个字节，总长度不超过65,535字节，正好放进一个IP数据包。

### 40.1.5 应用层

### 40.1.6 socket

### 40.1.7 小结